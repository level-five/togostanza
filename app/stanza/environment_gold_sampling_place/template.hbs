<!DOCTYPE html>

<html>
  <head>
    <title>Environment GOLD Sampling Place</title>
    <!--<link rel="stylesheet" href="{{css_uri}}" />-->

  <style type="text/css">
    html { height: 100% }
    body { height: 100%; margin: 0px; padding: 0px }
    #map { height: 100% }
  </style>
  <script src="http://maps.google.com/maps/api/js?v=3&sensor=false" type="text/javascript" charset="UTF-8"></script>
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
  <script type="text/javascript">
  //<![CDATA[

  var map;

  // add mouseover and mousedown event listener
  function attachMessage(marker, msg) {
    google.maps.event.addListener(marker, 'mouseover', function(event) {
      new google.maps.InfoWindow({
        content: msg
      }).open(marker.getMap(), marker);
    });  
  }

  //initialize 
  function init() {
    var data = new Array();
    $.getJSON("./environment_gold_sampling_place/resources/place_list/?meo_id={{select_meo_id}}", function(json) {
      //console.log(json.place_list);
      for (var i = 0 ; i < json.place_list.length ; i++) {
        link = '';
        for (var k=0 ; k<json.place_list[i].goldlist.length ; k++) {
          link = link + '<a href="' + json.place_list[i].goldlist[k].gold + '" target="_blank">' + json.place_list[i].goldlist[k].gold_id + '</a> ';
        }
        data.push({position: new google.maps.LatLng(json.place_list[i].latitude, json.place_list[i].longitude), content: json.place_list[i].place_name + '<br>' + link});
      }
      draw_map(data);
    }); 
  }
  function draw_map(data) {
    // settings for Google Map
    var latlng = new google.maps.LatLng(35, 139);
    var opts = {
      zoom: 2,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      center: latlng
    };

    // Create map object
    // Parameters are DOM which is drawn map and optional setting object.
    map = new google.maps.Map(document.getElementById("map"), opts);

    for (i = 0; i < data.length; i++) {
      var myMarker = new google.maps.Marker({
        position: data[i].position,
        map: map
      });
      attachMessage(myMarker, data[i].content);
    }
  }
  //]]>
  </script>
  </head>

  <body onload="init()">
    <div id="map"></div>
  </body>
</html>

